{
  "$schema": "http://json-schema.org/draft-04/schema#",
  "type": "object",
  "additionalProperties": true,
  "definitions": {
    "details": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "body",
        "first_public_at",
        "government",
        "political"
      ],
      "properties": {
        "body": {
          "type": "string"
        },
        "first_public_at": {
          "type": "string",
          "format": "date-time"
        },
        "emphasised_organisations": {
          "description": "The content ids of the organisations that should be displayed first in the list of organisations related to the item, these content ids must be present in the item organisation links hash.",
          "type": "array",
          "items": {
            "$ref": "#/definitions/guid"
          }
        },
        "government": {
          "$ref": "#/definitions/government"
        },
        "political": {
          "$ref": "#/definitions/political"
        },
        "change_history": {
          "$ref": "#/definitions/change_history"
        }
      }
    },
    "links": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "fields_of_operation"
      ],
      "properties": {
        "fields_of_operation": {
          "minItems": 1,
          "$ref": "#/definitions/guid_list"
        },
        "ministers": {
          "$ref": "#/definitions/guid_list"
        },
        "alpha_taxons": {
          "description": "Prototype-stage taxonomy label for this content item",
          "$ref": "#/definitions/guid_list"
        },
        "mainstream_browse_pages": {
          "description": "Powers the /browse section of the site. These are known as sections in some legacy apps.",
          "$ref": "#/definitions/guid_list"
        },
        "topics": {
          "description": "Powers the /topic section of the site. These are known as specialist sectors in some legacy apps.",
          "$ref": "#/definitions/guid_list"
        },
        "organisations": {
          "description": "All organisations linked to this content item. This should include lead organisations.",
          "$ref": "#/definitions/guid_list"
        },
        "lead_organisations": {
          "description": "DEPRECATED: A subset of organisations that should be emphasised in relation to this content item. All organisations specified here should also be part of the organisations array.",
          "$ref": "#/definitions/guid_list"
        },
        "parent": {
          "description": "The parent content item.",
          "$ref": "#/definitions/guid_list",
          "maxItems": 1
        },
        "policies": {
          "description": "These are for collecting content related to a particular government policy.",
          "$ref": "#/definitions/guid_list"
        },
        "policy_areas": {
          "description": "A largely deprecated tag currently only used to power email alerts.",
          "$ref": "#/definitions/guid_list"
        }
      }
    },
    "absolute_path": {
      "type": "string",
      "pattern": "^/(([a-zA-Z0-9._~!$&'()*+,;=:@-]|%[0-9a-fA-F]{2})+(/([a-zA-Z0-9._~!$&'()*+,;=:@-]|%[0-9a-fA-F]{2})*)*)?$",
      "description": "A path only. Query string and/or fragment are not allowed."
    },
    "absolute_fullpath": {
      "type": "string",
      "pattern": "^/(([a-zA-Z0-9._~!$&'()*+,;=:@-]|%[0-9a-fA-F]{2})+(/([a-zA-Z0-9._~!$&'()*+,;=:@-]|%[0-9a-fA-F]{2})*)*)?(\\?([a-zA-Z0-9._~!$&'()*+,;=:@-]|%[0-9a-fA-F]{2})*)?(#([a-zA-Z0-9._~!$&'()*+,;=:@-]|%[0-9a-fA-F]{2})*)?$",
      "description": "A path with optional query string and/or fragment."
    },
    "analytics_identifier": {
      "anyOf": [
        {
          "type": "string"
        },
        {
          "type": "null"
        }
      ],
      "description": "A short identifier we send to Google Analytics for multi-valued fields. This means we avoid the truncated values we would get if we sent the path or slug of eg organisations."
    },
    "government": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "title",
        "slug",
        "current"
      ],
      "properties": {
        "title": {
          "type": "string",
          "description": "Name of the government that first published this document, eg '1970 to 1974 Conservative government'."
        },
        "slug": {
          "type": "string",
          "description": "Government slug, used for analytics, eg '1970-to-1974-conservative-government'."
        },
        "current": {
          "type": "boolean",
          "description": "Is the government that published this document still the current government."
        }
      }
    },
    "guid": {
      "type": "string",
      "pattern": "^[a-f0-9]{8}-[a-f0-9]{4}-[1-5][a-f0-9]{3}-[89ab][a-f0-9]{3}-[a-f0-9]{12}$"
    },
    "guid_list": {
      "type": "array",
      "uniqueItems": true,
      "items": {
        "$ref": "#/definitions/guid"
      }
    },
    "image": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "url"
      ],
      "properties": {
        "url": {
          "type": "string",
          "format": "uri"
        },
        "alt_text": {
          "type": "string"
        },
        "caption": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ]
        }
      }
    },
    "political": {
      "type": "boolean",
      "description": "If the content is considered political in nature, reflecting views of the government it was published under."
    },
    "route": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "path",
        "type"
      ],
      "properties": {
        "path": {
          "type": "string"
        },
        "type": {
          "enum": [
            "prefix",
            "exact"
          ]
        }
      }
    },
    "redirect_route": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "path",
        "type",
        "destination"
      ],
      "properties": {
        "path": {
          "$ref": "#/definitions/absolute_path"
        },
        "type": {
          "enum": [
            "prefix",
            "exact"
          ]
        },
        "destination": {
          "$ref": "#/definitions/absolute_fullpath"
        },
        "segments_mode": {
          "enum": [
            "preserve",
            "ignore"
          ],
          "description": "For prefix redirects, preserve or ignore the rest of the fullpath. For exact, preserve or ignore the querystring."
        }
      }
    },
    "multiple_content_types": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "content_type",
          "content"
        ],
        "properties": {
          "content_type": {
            "type": "string"
          },
          "content": {
            "type": "string"
          }
        }
      }
    },
    "asset_link": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "url",
        "content_type"
      ],
      "properties": {
        "content_id": {
          "$ref": "#/definitions/guid"
        },
        "url": {
          "type": "string",
          "format": "uri"
        },
        "content_type": {
          "type": "string"
        },
        "title": {
          "type": "string"
        },
        "created_at": {
          "format": "date-time"
        },
        "updated_at": {
          "format": "date-time"
        }
      }
    },
    "change_history": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "properties": {
          "public_timestamp": {
            "type": "string",
            "format": "date-time"
          },
          "note": {
            "type": "string",
            "description": "A summary of the change"
          },
          "reason_for_change": {
            "type": "string",
            "description": "Why the change is being made. This is multiline text, and will be rendered inside <p> tags. Govspeak is not yet supported here."
          }
        },
        "required": [
          "public_timestamp",
          "note"
        ]
      }
    },
    "withdrawn_notice": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "explanation": {
          "type": "string"
        },
        "withdrawn_at": {
          "format": "date-time"
        }
      }
    },
    "nation_applicability": {
      "description": "An object specifying the applicability of a particular nation.",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "label": {
          "description": "The pretty-printed, translated label for this nation.",
          "type": "string"
        },
        "alternative_url": {
          "description": "An optional alternative URL to link to for more information on this content item pertaining to this nation.",
          "type": "string"
        },
        "applicable": {
          "description": "Whether the content applies to this nation or not.",
          "type": "boolean"
        }
      }
    },
    "national_applicability": {
      "description": "An object specifying the applicable nations for this content item. If it applies to all nations, it should be omitted.",
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "england": {
          "$ref": "#/definitions/nation_applicability"
        },
        "northern_ireland": {
          "$ref": "#/definitions/nation_applicability"
        },
        "scotland": {
          "$ref": "#/definitions/nation_applicability"
        },
        "wales": {
          "$ref": "#/definitions/nation_applicability"
        }
      }
    }
  },
  "oneOf": [
    {
      "properties": {
        "format": {
          "type": "string",
          "enum": [
            "fatality_notice"
          ]
        },
        "base_path": {
          "$ref": "#/definitions/absolute_path"
        },
        "title": {
          "type": "string"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ]
        },
        "public_updated_at": {
          "type": "string",
          "format": "date-time"
        },
        "publishing_app": {
          "type": "string"
        },
        "rendering_app": {
          "type": "string"
        },
        "locale": {
          "type": "string"
        },
        "need_ids": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "routes": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/route"
          }
        },
        "redirects": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/redirect_route"
          }
        },
        "access_limited": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "users"
          ],
          "properties": {
            "users": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "analytics_identifier": {
          "$ref": "#/definitions/analytics_identifier"
        },
        "phase": {
          "description": "The service design phase of this content item - https://www.gov.uk/service-manual/phases",
          "type": "string",
          "enum": [
            "alpha",
            "beta",
            "live"
          ]
        },
        "details": {
          "$ref": "#/definitions/details"
        },
        "content_id": {
          "$ref": "#/definitions/guid"
        },
        "update_type": {
          "enum": [
            "major",
            "minor",
            "republish"
          ]
        },
        "links": {
          "$ref": "#/definitions/links"
        }
      },
      "required": [
        "format",
        "title",
        "details",
        "publishing_app",
        "rendering_app",
        "locale",
        "routes",
        "public_updated_at",
        "content_id",
        "update_type"
      ],
      "additionalProperties": false
    },
    {
      "properties": {
        "document_type": {
          "type": "string"
        },
        "schema_name": {
          "type": "string",
          "enum": [
            "fatality_notice"
          ]
        },
        "base_path": {
          "$ref": "#/definitions/absolute_path"
        },
        "title": {
          "type": "string"
        },
        "description": {
          "anyOf": [
            {
              "type": "string"
            },
            {
              "type": "null"
            }
          ]
        },
        "public_updated_at": {
          "type": "string",
          "format": "date-time"
        },
        "publishing_app": {
          "type": "string"
        },
        "rendering_app": {
          "type": "string"
        },
        "locale": {
          "type": "string"
        },
        "need_ids": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "routes": {
          "type": "array",
          "minItems": 1,
          "items": {
            "$ref": "#/definitions/route"
          }
        },
        "redirects": {
          "type": "array",
          "items": {
            "$ref": "#/definitions/redirect_route"
          }
        },
        "access_limited": {
          "type": "object",
          "additionalProperties": false,
          "required": [
            "users"
          ],
          "properties": {
            "users": {
              "type": "array",
              "items": {
                "type": "string"
              }
            }
          }
        },
        "analytics_identifier": {
          "$ref": "#/definitions/analytics_identifier"
        },
        "phase": {
          "description": "The service design phase of this content item - https://www.gov.uk/service-manual/phases",
          "type": "string",
          "enum": [
            "alpha",
            "beta",
            "live"
          ]
        },
        "details": {
          "$ref": "#/definitions/details"
        },
        "content_id": {
          "$ref": "#/definitions/guid"
        },
        "update_type": {
          "enum": [
            "major",
            "minor",
            "republish"
          ]
        },
        "links": {
          "$ref": "#/definitions/links"
        }
      },
      "required": [
        "document_type",
        "schema_name",
        "title",
        "details",
        "publishing_app",
        "rendering_app",
        "locale",
        "routes",
        "public_updated_at",
        "content_id",
        "update_type"
      ],
      "additionalProperties": false
    }
  ]
}
